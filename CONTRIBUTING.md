# How to contribute

The paper development process is based on markdown, git, Docker, pandoc, and csl.
The goal is to support the collaborative writing process effectively, building on powerful open source tools, and supporting efficient production of documents for submission.

- [Repository structure](#repository-structure)
- [Setup](#setup)
- [Workflow](#workflow)
  - [Editing the paper](#editing-the-paper)
  - [Contributing changes](#contributing-changes)
  - [Retrieving changes from coauthors](#retrieving-changes-from-coauthors)
  - [Collaborating with Word users](#collaboration-with-word-users)
  - [Submitting the paper](#submitting-the-paper)
  - [Revising the paper](#revising-the-paper)
  - [Publishing the paper](#publishing-the-paper)
- [Principles](#principles)

# Repository structure

Based on [cookiecutter data science](https://drivendata.github.io/cookiecutter-data-science/).

```
├── analysis      <- directory contains all scripts and corresponding
│   │                Dockerfile(s) for the analyses
│   └─ Makefile   <- contains instructions to run the analyses
├── data          <- directory contains all data. The sub-directories are
│   |                optional and should be used for more complex processing
│   |                pipelines.
│   └─ raw        <- raw data
│   └─ interim    <- interim data
│   └─ processed  <- processed data
├── figures       <- directory contains all conceptual figures
├── output        <- directory contains all output, such as data plots and
│                    tables, which is generated by the scripts (do not store
│                    anything else that is not generated by the scripts in this
│                    directory)
├── Dockerfile    <- describes the pandoc container for building the paper
│                    (called by the Makefile)  
├── Makefile      <- contains instructions to build the paper (as pdf or docx),
│                    and run the analyses (if a Makefile exists in the analysis
│                    directory)
├── paper.md      <- contains the paper
├── readme.md     <- contains summaries of the paper's revisions (completed and
│                    ongoing). Revision sheets are created from this document.
└── .gitignore    <- contains a list of files that are excluded from git
                     versioning (e.g., paper.pdf, which would create conflicts
                     when merging changes)
```

Optional: shared and symlinked directories

To avoid handling redundant and possibly outdated files across paper projects, it is recommended to use shared bibliographies, shared templates, and the styles provided by the CSL community.
Any of the bibliographies (\*.bib), templates (\*.docx, \*.tex), or styles (\*.csl) can also be versioned in the individual paper repository.
This can be accomplished by using the code in comments at the beginning of the [Makefile](Makefile).
Symlinks to shared directory are ignored in [git versioning](.gitignore).

```
├── bibliography  <- a symlink to the shared bibliography
├── styles        <- a symlink to a local clone of the csl styles
|                    https://github.com/citation-style-language/styles
├── templates     <- a symlink to the shared template repository
```

# Setup

This section explains how to install the environment and build the paper.
[Git](https://git-scm.com/), [Docker](https://www.docker.com/) and make are required.
The following steps describe how to

  - 1a. Create a new repository _or_
  - 1b. Contribute to an existing repository,
  - 2. Set up the paper production pipeline, and
  - 3. Build the paper

1a) Create a new repository

```
git clone https://github.com/geritwagner/manuscript-template
# remove the .git directory containing older versions
rm -rf .git*
# repo setup:
git init
# MANUALLY create paper (update titles etc.)
git add .
git commit -m 'initial commit'
# connect to git remote
# MANUALLY update url in the following line
git remote add origin https://github.com/....
git branch -M main
git push -u origin main
# MANUALLY invite coauthors/provide access to the remote repository
```

1b) Contribute to an existing repository

```
# pull repository
git clone https://...
```

2) Set up the paper production pipeline

```
# MANUALLY set up the paths for the shared directories or clone them using the following commands:
git clone https://github.com/geritwagner/bibliography ../bibliography
git clone https://github.com/citation-style-language/styles ../styles
git clone https://github.com/geritwagner/templates ../templates
ln -s ../styles
ln -s ../templates
ln -s ../bibliography
# Build the Docker container
docker build -t pandoc_dockerfile .
```

3) Build the paper

```
make pdf
make docx
```

# Workflow

Changes are tracked by the collaborative versioning system git.
Tutorials on git are available online ([1](https://learngitbranching.js.org/), [2](https://github.com/jlord/git-it-electron)).

## Editing the paper

The [paper](paper.md) is written in markdown.
Useful guides on markdown are available online ([1](https://bookdown.org/yihui/rmarkdown/), [2](https://bookdown.org/yihui/rmarkdown-cookbook/)).
Several editors are available for markdown documents:

- [Atom](https://shd101wyy.github.io/markdown-preview-enhanced/#/)
- [Panwriter](https://panwriter.com/)

The bibliography is stored as a bib file and versioned in a git repository.
It can be edited using tools like [JabRef](https://github.com/JabRef/jabref).
It is recommended to configure save actions to [store titles as sentence case](https://docs.jabref.org/finding-sorting-and-cleaning-entries/saveactions#sentence-case), [normalize names of persons for author fields](https://docs.jabref.org/finding-sorting-and-cleaning-entries/saveactions#normalize-names-of-persons), and to [normalize page numbers](https://docs.jabref.org/finding-sorting-and-cleaning-entries/saveactions#normalize-page-numbers).
Changes in the bib-file should be checked before committing and adding {} to protect cases when necessary (e.g., `{J}ab{R}ef`).

- Begin each sentence in a new line to make the history more readable and to make merging easier (see [semantic line breaks](https://sembr.org/)).

A very useful possibility is to include comments throughout the markdown document:

```
<!-- This is a comment (adding further explanations, links to resources or parts of the papers that were shortened)-->
```

Papers are cited using the citation keys in the bib-file and the citation syntax @Webster2002 or [@Webster2002].
Groups of in-text citations should be sorted alphabetically (especially if a prefix is used), i.e., use [e.g., @Bacharach1989; @Gregor2006a] instead of [e.g., @Gregor2006a; @Bacharach1989].

To add papers that are cited in the figure to the reference section, include the following in the YAML header of paper.md:

```
nocite: |
  @citation_key
```

Further Information on the [citation syntax](https://pandoc.org/MANUAL.html#citation-syntax) is available in the pandoc manual.

Figures can be included as follows and referred to as @fig:distribution.
Further information on [pandoc-crossref](https://lierdakil.github.io/pandoc-crossref/) is available online.

```
![Figure Caption](figure.jpg){#fig:distribution width=300px}
```

To ensure compatibility with pandoc word and latex conversion, figures should be included as jpg/png.
For the final versions, PDFs/EMFs should be included for Latex/Word respectively.

Describe newline best-practice

$$ P_i(x) = \sum_i a_i x^i $$ {#eq:eqn1}

| T1   | T2   | T3   |
| ---- | ---- | ---- |
| C11  | C12  | C13  |
| C21  | C22  | C23  |
| C31  | C32  | C33  |

: Table example {#tbl:table1}

Pantable:

```table
---
caption: '*Awesome* **Markdown** Table {#tbl:short_ref}'
alignment: RC
table-width: 2/3
markdown: True
---
First row,defaulted to be header row,can be disabled
1,cell can contain **markdown**,"It can be aribrary block element:

- following standard markdown syntax
- like this"
2,"Any markdown syntax, e.g.",E = mc^2^
```

Footnotes can be added [^1].

  [^1]: Example footnote.


Formatting the bibliography (*.bib file)

- Title field: use sentence case (e.g., "On the origin of species", not "On the Origin of Species"). CSL styles that require title case will use an automatic title-case conversion ([1](https://citationstyles.org/authors/#/titles-in-sentence-and-title-case)).

- Journal field: use long version (e.g., "Journal of Information Technology", not "JIT"). For CSL styles that require abbreviations, temporarily replace the journal field in the bib-file since CSL does not handle style-specific journal abbreviations ([1](https://citationstyles.org/authors/#/csl-limitations)). JSON-files containing journal abbreviations can be passed to pandoc using the [citation-abbreviations](https://pandoc.org/MANUAL.html#option--citation-abbreviations) field.

- Inproceedings: when using crossrefs (e.g., `crossref = {icis2010}`) for conference papers, the year and month field should _not_ be set, only the original \@Proceedings entry should include the date formatted as follows: `date    = {2015-12-13/2015-12-16}`.


## Contributing changes

- Check the git-diff (gitk) before committing changes.
- Use the following commit message format (do not start commit message with #3):
```
git commit -m 'address limitations [iss28]'
```
- Commit minor changes directly to the `polishing` branch, use dedicated branches otherwise (especially when changes need to be discussed in a pull-request).
- Create a single branch for issues that are related (e.g., group all issues referring to the introduction in the branch `update_introduction`).
- Example:
```
git checkout main
git checkout -b iss12
```
- While working locally on the iss12, rebase it on main when the main branch has been updated by coauthors (for better management of the history):
```
git checkout iss12
git rebase main
```
- Once the branch is ready for review, revisions, and merging, share it:
```
git push iss12
# set the upstream branch as suggested
```
- Do not rebase shared branches while working on it.
- Discuss, revise and merge on shared branches (github.com).
- Merge when changes have been confirmed:
```
git checkout main
git merge --squash iss12
git push
```

## Retrieving changes from coauthors

- When your repository has local changes (commits): pull-rebase to avoid unnecessary merge commits:
```
git pull --rebase
```

- When your repository has local changes (uncommitted): stash and pull-rebase:
```
git stash
git pull --rebase
git stash apply
```

## Collaboration with Word users

Whenever possible, **ask active coauthors to modify the paper.md file**.

Otherwise:

- To share: create a commit with the latest changes.
- Export paper as word file.
- Filename: increment the version number with every docx file that is shared externally (example: `Manuscript_v11.docx`).
- For you own reference, you may store the same file in a local directory, including the hash-id of the latest commit as the second part of the filename  (example: `Manuscript_v11 d091j209fs8.docx`).
This can be useful to track the mapping between version numbers and the corresponding hash-id (git history).

- When receiving feedback in the docx: always make sure that feedback (including tracked and untracked changes) is transferred to the [paper](paper.md) manually.

## Submitting the paper

This checklist can be used to produce camera-ready papers (initials submissions, revisions, and final versions).
The checks should be completed in order (keep this in mind when updating this checklist).

"Things that cannot be fixed 1h before the submission deadline":

- Have a knowledgeable colleague read the paper and provide feedback.
- Consider publishing the data/analyses (e.g., on figshare, github, zenodo).
- Is the research question stated clearly in the first few sentences of  the abstract and the introduction?
- If your article was a reject (or revise) and resubmit, did you clearly fix any concerns?
- Check whether there is previous research in the target journal that can be cited.

### Orga

- Check submission deadline

### Clarity

- Have any major conceptual changes/prominent phrases been changed recently?
- Consistently use the same terminology (avoid synonyms) of conceptually relevant terms
- Present major conceptual blocks in the same order (same numbering for hypotheses)

### Up-to-date

 - Use latest statistics (e.g., including exclusion criteria)
 - Use latest model results
 - The variables in the background/methodology/results/discussion/intro/abstract/conclusion should be the same

### Template, formatting, and spell-checking

- Used the correct template from the journal website? This might require an additional, external checklist.
- Select and check citation style? [Search by example](https://csl.mendeley.com/searchByExample/)

- Check page limit
- Spell-check (e.g., in Word)
    - Check tempus (methodology: simple past)
    - Check common mistakes (e.g., comma for which/who, i.e./e.g. should be in parentheses, using "an" before  vowel sounds, e.g., an hour but a horse)
    - Remove double-spaces
    - Abbreviations introduced _and_ used consistently?
    - Consistent capitalization (headings, captions, ...)
    - Consistent terminology (e.g., paper vs. article)
    - Use the same decimal separator throughout the paper (. or ,)
- Check tables and figures
    - Check references to figures, tables and appendices
    - Are your figures/tables self-contained? You should be able to read the article without looking at the figures/tables and vice versa.
    - Tables:
      - Check alignment of decimals
      - Are table legends appropriate?
      - Are tables embedded into the main text?
      - Have tables been cited in the text?
      - Do the citations refer to the CORRECT table/figure?
      - For better alignment: adjust paragraph -> indentation, margin left/right.
    - Figures:
      - Alignment: Central in article with consistent margins inside the figure.
      - Use the same font-type for the text and the figures.
      - Use vector graphics.
      - Figures should include searchable text (Word: emf/wmf vector graphics)
      - For screenshots: include as PDF with OCR
    - Check figures/tables and include references in the yaml header ([no cite](https://pandoc.org/MANUAL.html#including-uncited-items-in-the-bibliography))
- Check references
     - Go through reference list and check whether there are references that have been included accidentally (different topic)
     - Bibliography: check whether all citations are in the bibliography
     - Direct quotes should include a reference to the specific page
     - Consistent use of "Anonymous" instead of clear author name (if blinding is required)
     - Search paper for "reference" (to catch notes like ("reference needed"))
     - Check in-text citations: correctly cited? separated by semicolons?

The following should not be necessary (when the word/latex reference documents work properly):

- Consistent use of font sizes, types in figures and tables
- Alignment of Headings etc.
- Formatting of footnotes
- Text-alignment/blocks (for all paragraphs)

### Final checks

- Make sure that the paper is anonymous (remove authors from [paper.md](paper.md) before creating the docx/pdf, [inspect word document for personal information](https://support.microsoft.com/en-us/topic/remove-hidden-data-and-personal-information-by-inspecting-documents-presentations-or-workbooks-356b7b5d-77af-44fe-a07f-9aa4d085966f))
- Compare with previous version to catch accidental changes (Word: Check, Compare documents)
- Check the PDF. There might be problems when creating the PDF from the word document.
- Update abstract in submission system?

### Post-submission tasks:

Upon submission, a PaperID is usually assigned by the submission system.

- paper repository:
    - Create YYYY-MM-DD-JOURNAL_Paper_PaperID.pdf
    - Create YYYY-MM-DD-JOURNAL_Submission_proof_PaperID.pdf
    - Create YYYY-MM-DD-JOURNAL_Revision_sheet_PaperID.pdf
    - Create YYYY-MM-DD-JOURNAL_Cover_letter_PaperID.pdf
    - Link in readme.md
    - Create git-tag
- Analyses repository:
  - Tag git-repo (CHECK whether the data exactly matches the paper!, e.g., compare regression results)
  - Add specific version to Dockerfile (e.g., FROM rocker/tidyverse:3.4.3)
  - Build dockerfile (docker build .)
  - Run analyses in Dockerfile
  - Save python package versions (pip freeze > requirements.txt)
  - Create git-commit + tag
  - Change Dockerfile to latest (e.g., FROM rocker/tidyverse)
  - to do: add note somewhere on how to restore python package versions (pip install -r requirements.txt)
- Reminder to check the progress of the submission
- Add to waiting for
- Inform coauthors about the submission
- Update personal paper portfolio
- Thank co-authors/research-associates

## Revising the paper

1. Organize revision

- Track the deadline
- Determine who will lead the revision
- Determine who will contribute in which capacity and ask for availability
- Create local/personal revision directory (name: revision-id)
- Plan proof-reading

2. Create the revision sheet

- Add the review package to the paper directory (YYYY-MM-DD-Outlet-revision-id.pdf)
- Create revision sheet, use [revision-sheet-generator](https://github.com/geritwagner/revision-sheet-generator)
- Check result
- Add table with the revision package to paper-repo/readme.md as a separate section at the end
  - Heading: Date - Outlet (Revision-ID)
  - Revision lead: indicate who is responsible for the revision
  - Review package: link to the PDF of the review package (see example at the end)
  - Table including the comments
  - Continue running numbers for each comment
  - In each cell of the response column: indicate the git branch and who is responsible
    - Format of branch names: iss_x_name (e.g., iss_44_update_background)
    - Major issues are addressed in individual branches
    - Major issues that are mentioned by multiple reviewers/editors are addressed in the same branch (possible approach: color-code the review according to the sections in which to address the comments)
    - Minor issues (e.g., fixing typos) are addressed in the polishing branch
- After the table, provide a rough schedule, e.g.,
    - Calendar week 4: iss_1, iss_5, iss_6
    - Calendar week 5: iss_2, iss_3
    - Calendar week 6: polishing, proof-reading, and pre-submission checks
- Start with the major comments and keep track of the deadline

3. Address the comments

- Assign coauthors to comments and track reviewing of changes
- Address the feedback
- Use (and update) the a revision checklist (e.g., common phrases)
- Notes:
  - Do not shut down reviewers
  - Prioritize (you may not be able to address everything)
  - Manage the tension between cosmetic changes and a high effort/no plan approach
  - For important papers: consider going beyond and above what the AE/reviewers expect
  - In rare cases: point out to the editor that particular reviewers/comments cannot be addressed (differences in judgments, ...)
- Proof-reading
- Run the [pre-submission checklist](#pre-submission-checks)
- Update the running numbers in the revision sheet/tables (if they did not start with 1)

4. Submit
- Link submission documents in readme.md


Example (copy and append at the end of readme.md)


  # Journal: major revision

  [review package](YYYY-MM-DD-Revision-comments.pdf)

  ```table
  ---
  alignment: LLL
  markdown: True
  width: [0.1, 0.5, 0.4]
  ---
  ,Associate Editor's Comments,Response
  "1","INSERT_COMMENT","INSERT_RESPONSE"

  ```
  Submitted [paper](YYYY-MM-DD-Journal_Paper_PaperID.pdf) and [revision sheet](YYYY-MM-DD-Journal_Revision_sheet_PaperID.pdf).


## Publishing the paper

- Check and update metadata (authors, title, ...)
- Latex: Check if .tex writes metadata to PDF (final version, not for submissions/revisions):

```
\usepackage[pdftitle={Title of the paper}, pdfauthor={AuthorName FamilyName, AuthorName FamilyName}, pdfkeywords={keyword1, keyword2}]{hyperref}
```
- Include the keywords and abstract in the yaml header of [paper.md](paper.md).
- Acknowledge support by a funding body, acknowledge colleagues, reviewers (e.g., "The authors are grateful to the three expert reviewers for their exceptional comments.")
- Inform colleagues about the new publication
- Add the publication record to your CV, [ORCID](https://orcid.org/), your [GoogleScholar](https://scholar.google.com/intl/de/scholar/citations.html) profile, institutional website, and personal website

# Principles

This section summarizes underlying architectural principles and considerations.

- Minimal functionality: the most frequent use cases (writing, citing, creating submission files in docx/latex format with different templates and citation styles) must be supported in a highly efficient way.
More complex functionality (such as tables with merged cells and detailed formatting) is used less frequently (requiring less effort if not supported in an efficient way).
It may also create fewer problems (e.g., merging complex tables - as in Word/comparisons of tables)

Advantages of the markdown/pandoc workflow:

- Separation of content and format
- Collaboration and versioning of text with git
- Relying on active open source projects such as the [CSL](https://citationstyles.org/) standard
- Flexibility regarding the bibliography type (pandoc supports .bib, .enl, ...)
- Combined writing and comments in the same document
- Reproducibility across platforms
- Generating docx/tex/pdf as output

Since the underlying open source projects (especially CSL, pandoc, pandoc-citeproc) evolve constantly, it is recommended to work with the latest versions.
This is a limitation of the popular [manubot project](https://github.com/manubot/rootstock) or [pandoc scholar](https://github.com/pandoc-scholar/pandoc-scholar), which work with old versions of pandoc (which may be hard to update).

Possible extensions (lua-filters): [bibexport](https://github.com/pandoc/lua-filters/tree/master/bibexport), [abstract-to-meta](https://github.com/pandoc/lua-filters/tree/master/abstract-to-meta), [spellcheck](https://github.com/pandoc/lua-filters/tree/master/spellcheck), [wordcount](https://github.com/pandoc/lua-filters/tree/master/wordcount).
